=== RUN   TestActionService_Stake_TableDriven
=== RUN   TestActionService_Stake_TableDriven/internal_transfers_zero_cashflow
2025/11/19 11:48:10 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 27.4.0
  API Version: 1.46
  Operating System: Docker Desktop
  Total Memory: 9937 MB
  Testcontainers for Go Version: v0.32.0
  Resolved Docker Host: unix:///var/run/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 317bbd50dc57c7ac93a1462fd15d2eff1da20d189fc9d99367b05406505e7d56
  Test ProcessID: 1fecdfca-9ddb-46fb-8bae-4b3e15344321
2025/11/19 11:48:10 ğŸ³ Creating container for image testcontainers/ryuk:0.7.0
2025/11/19 11:48:10 âœ… Container created: ea481cb55458
2025/11/19 11:48:10 ğŸ³ Starting container: ea481cb55458
2025/11/19 11:48:10 âœ… Container started: ea481cb55458
2025/11/19 11:48:10 â³ Waiting for container id ea481cb55458 image: testcontainers/ryuk:0.7.0. Waiting for: &{Port:8080/tcp timeout:<nil> PollInterval:100ms}
2025/11/19 11:48:10 ğŸ”” Container is ready: ea481cb55458
2025/11/19 11:48:10 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:10 âœ… Container created: eb1fe5e525b9
2025/11/19 11:48:10 ğŸ³ Starting container: eb1fe5e525b9
2025/11/19 11:48:11 âœ… Container started: eb1fe5e525b9
2025/11/19 11:48:11 â³ Waiting for container id eb1fe5e525b9 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005232f8 Strategies:[0xc0000f77d0]}
2025/11/19 11:48:11 ğŸ”” Container is ready: eb1fe5e525b9

2025/11/19 11:48:12 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.152ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Binance Earn' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:12 ğŸ³ Terminating container: eb1fe5e525b9
2025/11/19 11:48:12 ğŸš« Container terminated: eb1fe5e525b9
--- PASS: TestActionService_Stake_TableDriven (1.66s)
    --- PASS: TestActionService_Stake_TableDriven/internal_transfers_zero_cashflow (1.66s)
=== RUN   TestActionService_Unstake_TableDriven
=== RUN   TestActionService_Unstake_TableDriven/internal_transfers_zero_cashflow
2025/11/19 11:48:12 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:12 âœ… Container created: c9faa7a33fcf
2025/11/19 11:48:12 ğŸ³ Starting container: c9faa7a33fcf
2025/11/19 11:48:12 âœ… Container started: c9faa7a33fcf
2025/11/19 11:48:12 â³ Waiting for container id c9faa7a33fcf image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000392a10 Strategies:[0xc000153410]}
2025/11/19 11:48:13 ğŸ”” Container is ready: c9faa7a33fcf

2025/11/19 11:48:13 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.977ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Binance Earn' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:13 ğŸ³ Terminating container: c9faa7a33fcf
2025/11/19 11:48:13 ğŸš« Container terminated: c9faa7a33fcf
=== RUN   TestActionService_Unstake_TableDriven/with_explicit_amount_and_close_all
2025/11/19 11:48:13 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:13 âœ… Container created: 86d9d0bad3e5
2025/11/19 11:48:13 ğŸ³ Starting container: 86d9d0bad3e5
2025/11/19 11:48:13 âœ… Container started: 86d9d0bad3e5
2025/11/19 11:48:13 â³ Waiting for container id 86d9d0bad3e5 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc00049a670 Strategies:[0xc000590570]}
2025/11/19 11:48:14 ğŸ”” Container is ready: 86d9d0bad3e5

2025/11/19 11:48:14 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.230ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:14 ğŸ³ Terminating container: 86d9d0bad3e5
2025/11/19 11:48:14 ğŸš« Container terminated: 86d9d0bad3e5
=== RUN   TestActionService_Unstake_TableDriven/PnL_calculation
2025/11/19 11:48:14 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:14 âœ… Container created: 948118c0d1f5
2025/11/19 11:48:14 ğŸ³ Starting container: 948118c0d1f5
2025/11/19 11:48:14 âœ… Container started: 948118c0d1f5
2025/11/19 11:48:14 â³ Waiting for container id 948118c0d1f5 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000295040 Strategies:[0xc000617170]}
2025/11/19 11:48:15 ğŸ”” Container is ready: 948118c0d1f5

2025/11/19 11:48:15 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.749ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:15 ğŸ³ Terminating container: 948118c0d1f5
2025/11/19 11:48:15 ğŸš« Container terminated: 948118c0d1f5
--- PASS: TestActionService_Unstake_TableDriven (3.63s)
    --- PASS: TestActionService_Unstake_TableDriven/internal_transfers_zero_cashflow (1.22s)
    --- PASS: TestActionService_Unstake_TableDriven/with_explicit_amount_and_close_all (1.14s)
    --- PASS: TestActionService_Unstake_TableDriven/PnL_calculation (1.27s)
=== RUN   TestReportingService_GetExpectedBorrowOutflows_WithAPR
2025/11/19 11:48:15 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:15 âœ… Container created: 510b100d79e8
2025/11/19 11:48:15 ğŸ³ Starting container: 510b100d79e8
2025/11/19 11:48:15 âœ… Container started: 510b100d79e8
2025/11/19 11:48:15 â³ Waiting for container id 510b100d79e8 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc00049b670 Strategies:[0xc0005ecab0]}
2025/11/19 11:48:16 ğŸ”” Container is ready: 510b100d79e8
2025/11/19 11:48:16 ğŸ³ Terminating container: 510b100d79e8
2025/11/19 11:48:17 ğŸš« Container terminated: 510b100d79e8
--- PASS: TestReportingService_GetExpectedBorrowOutflows_WithAPR (1.25s)
=== RUN   TestReportingService_GetCashFlow_OperatingVsFinancing
2025/11/19 11:48:17 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:17 âœ… Container created: 9b5ff0ae34ef
2025/11/19 11:48:17 ğŸ³ Starting container: 9b5ff0ae34ef
2025/11/19 11:48:17 âœ… Container started: 9b5ff0ae34ef
2025/11/19 11:48:17 â³ Waiting for container id 9b5ff0ae34ef image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000522428 Strategies:[0xc00027f080]}
2025/11/19 11:48:17 ğŸ”” Container is ready: 9b5ff0ae34ef
2025/11/19 11:48:18 ğŸ³ Terminating container: 9b5ff0ae34ef
2025/11/19 11:48:18 ğŸš« Container terminated: 9b5ff0ae34ef
--- PASS: TestReportingService_GetCashFlow_OperatingVsFinancing (1.12s)
=== RUN   TestReportingService_GetHoldings_WithPercentages
2025/11/19 11:48:18 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:18 âœ… Container created: c826a9eb94d6
2025/11/19 11:48:18 ğŸ³ Starting container: c826a9eb94d6
2025/11/19 11:48:18 âœ… Container started: c826a9eb94d6
2025/11/19 11:48:18 â³ Waiting for container id c826a9eb94d6 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000392d00 Strategies:[0xc00027f0e0]}
2025/11/19 11:48:19 ğŸ”” Container is ready: c826a9eb94d6
2025/11/19 11:48:19 ğŸ³ Terminating container: c826a9eb94d6
2025/11/19 11:48:19 ğŸš« Container terminated: c826a9eb94d6
--- PASS: TestReportingService_GetHoldings_WithPercentages (1.20s)
=== RUN   TestReportingService_GetHoldingsByAsset_WithPercentages
2025/11/19 11:48:19 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:19 âœ… Container created: 1cc3203921f6
2025/11/19 11:48:19 ğŸ³ Starting container: 1cc3203921f6
2025/11/19 11:48:19 âœ… Container started: 1cc3203921f6
2025/11/19 11:48:19 â³ Waiting for container id 1cc3203921f6 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000711d78 Strategies:[0xc000153a40]}
2025/11/19 11:48:20 ğŸ”” Container is ready: 1cc3203921f6
2025/11/19 11:48:20 ğŸ³ Terminating container: 1cc3203921f6
2025/11/19 11:48:20 ğŸš« Container terminated: 1cc3203921f6
--- PASS: TestReportingService_GetHoldingsByAsset_WithPercentages (1.22s)
=== RUN   TestInvestmentService_StakeIntoExisting_ThenUnstake_PartialAndFull
2025/11/19 11:48:20 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:20 âœ… Container created: 1409a849550f
2025/11/19 11:48:20 ğŸ³ Starting container: 1409a849550f
2025/11/19 11:48:20 âœ… Container started: 1409a849550f
2025/11/19 11:48:20 â³ Waiting for container id 1409a849550f image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005230f0 Strategies:[0xc00027fc50]}
2025/11/19 11:48:21 ğŸ”” Container is ready: 1409a849550f

2025/11/19 11:48:21 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.903ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
    investment_process_test.go:100: expected investment to be closed after full unstake
2025/11/19 11:48:21 ğŸ³ Terminating container: 1409a849550f
2025/11/19 11:48:21 ğŸš« Container terminated: 1409a849550f
--- FAIL: TestInvestmentService_StakeIntoExisting_ThenUnstake_PartialAndFull (1.25s)
=== RUN   TestInvestmentModelValidation
--- PASS: TestInvestmentModelValidation (0.00s)
=== RUN   TestInvestmentFilterValidation
--- PASS: TestInvestmentFilterValidation (0.00s)
=== RUN   TestInvestmentSummaryValidation
--- PASS: TestInvestmentSummaryValidation (0.00s)
=== RUN   TestTransactionModelWithInvestmentFields
--- PASS: TestTransactionModelWithInvestmentFields (0.00s)
=== RUN   TestTransactionInvestmentTypeValidation
--- PASS: TestTransactionInvestmentTypeValidation (0.00s)
=== RUN   TestInvestmentCalculations
--- PASS: TestInvestmentCalculations (0.00s)
=== RUN   TestInvestmentRemainingQuantityCalculation
--- PASS: TestInvestmentRemainingQuantityCalculation (0.00s)
=== RUN   TestPnL_StakeUnstake
=== RUN   TestPnL_StakeUnstake/Full_position_close_with_loss
2025/11/19 11:48:21 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:21 âœ… Container created: a8fcb600b52b
2025/11/19 11:48:21 ğŸ³ Starting container: a8fcb600b52b
2025/11/19 11:48:22 âœ… Container started: a8fcb600b52b
2025/11/19 11:48:22 â³ Waiting for container id a8fcb600b52b image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc00049b350 Strategies:[0xc000616bd0]}
2025/11/19 11:48:22 ğŸ”” Container is ready: a8fcb600b52b

2025/11/19 11:48:22 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.844ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
    pnl_test.go:110: expected PnL -225, got 0
    pnl_test.go:113: expected ROI -45%, got 0%
2025/11/19 11:48:22 ğŸ³ Terminating container: a8fcb600b52b
2025/11/19 11:48:23 ğŸš« Container terminated: a8fcb600b52b
=== RUN   TestPnL_StakeUnstake/Partial_position_close_at_same_price
2025/11/19 11:48:23 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:23 âœ… Container created: e8c037f3d65b
2025/11/19 11:48:23 ğŸ³ Starting container: e8c037f3d65b
2025/11/19 11:48:23 âœ… Container started: e8c037f3d65b
2025/11/19 11:48:23 â³ Waiting for container id e8c037f3d65b image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0003256f0 Strategies:[0xc0001f1c20]}
2025/11/19 11:48:24 ğŸ”” Container is ready: e8c037f3d65b

2025/11/19 11:48:24 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.813ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:24 ğŸ³ Terminating container: e8c037f3d65b
2025/11/19 11:48:24 ğŸš« Container terminated: e8c037f3d65b
--- FAIL: TestPnL_StakeUnstake (2.51s)
    --- FAIL: TestPnL_StakeUnstake/Full_position_close_with_loss (1.23s)
    --- PASS: TestPnL_StakeUnstake/Partial_position_close_at_same_price (1.28s)
=== RUN   TestPnL_MultiDepositMultiClose
=== RUN   TestPnL_MultiDepositMultiClose/Two_deposits,_two_closes,_net_loss
2025/11/19 11:48:24 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:24 âœ… Container created: b143cfe041d7
2025/11/19 11:48:24 ğŸ³ Starting container: b143cfe041d7
2025/11/19 11:48:24 âœ… Container started: b143cfe041d7
2025/11/19 11:48:24 â³ Waiting for container id b143cfe041d7 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004e6838 Strategies:[0xc000616720]}
2025/11/19 11:48:25 ğŸ”” Container is ready: b143cfe041d7

2025/11/19 11:48:25 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.010ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
    pnl_test.go:207: expected PnL 250, got 0
    pnl_test.go:210: expected ROI 25%, got 0%
2025/11/19 11:48:25 ğŸ³ Terminating container: b143cfe041d7
2025/11/19 11:48:25 ğŸš« Container terminated: b143cfe041d7
--- FAIL: TestPnL_MultiDepositMultiClose (1.34s)
    --- FAIL: TestPnL_MultiDepositMultiClose/Two_deposits,_two_closes,_net_loss (1.33s)
=== RUN   TestPnL_FIFO_PartialCloseWithinPeriod
2025/11/19 11:48:25 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:25 âœ… Container created: 0f234a5cf3a0
2025/11/19 11:48:25 ğŸ³ Starting container: 0f234a5cf3a0
2025/11/19 11:48:25 âœ… Container started: 0f234a5cf3a0
2025/11/19 11:48:25 â³ Waiting for container id 0f234a5cf3a0 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0000126b0 Strategies:[0xc000395290]}
2025/11/19 11:48:26 ğŸ”” Container is ready: 0f234a5cf3a0

2025/11/19 11:48:26 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[2.932ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:26 ğŸ³ Terminating container: 0f234a5cf3a0
2025/11/19 11:48:26 ğŸš« Container terminated: 0f234a5cf3a0
--- PASS: TestPnL_FIFO_PartialCloseWithinPeriod (1.29s)
=== RUN   TestPnL_FIFO_SecondCloseOutsideFirstPeriod
2025/11/19 11:48:26 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:26 âœ… Container created: 12890a83d303
2025/11/19 11:48:26 ğŸ³ Starting container: 12890a83d303
2025/11/19 11:48:27 âœ… Container started: 12890a83d303
2025/11/19 11:48:27 â³ Waiting for container id 12890a83d303 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc00049b608 Strategies:[0xc0005914d0]}
2025/11/19 11:48:28 ğŸ”” Container is ready: 12890a83d303

2025/11/19 11:48:28 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.030ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
    pnl_test.go:377: expected PnL 175, got 0
    pnl_test.go:383: expected ROI 87.5%, got 0%
2025/11/19 11:48:28 ğŸ³ Terminating container: 12890a83d303
2025/11/19 11:48:28 ğŸš« Container terminated: 12890a83d303
--- FAIL: TestPnL_FIFO_SecondCloseOutsideFirstPeriod (1.33s)
=== RUN   TestPnL_SingleDepositFullClose_Profit
2025/11/19 11:48:28 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:28 âœ… Container created: d765719a3782
2025/11/19 11:48:28 ğŸ³ Starting container: d765719a3782
2025/11/19 11:48:28 âœ… Container started: d765719a3782
2025/11/19 11:48:28 â³ Waiting for container id d765719a3782 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0002d8638 Strategies:[0xc000152cf0]}
2025/11/19 11:48:29 ğŸ”” Container is ready: d765719a3782

2025/11/19 11:48:29 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.879ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
    pnl_test.go:437: expected PnL 100, got 0
    pnl_test.go:440: expected ROI 20%, got 0%
2025/11/19 11:48:29 ğŸ³ Terminating container: d765719a3782
2025/11/19 11:48:29 ğŸš« Container terminated: d765719a3782
--- FAIL: TestPnL_SingleDepositFullClose_Profit (1.32s)
=== RUN   TestPnL_NoCloseWithinPeriod_ZeroPnLAndROI
2025/11/19 11:48:29 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:29 âœ… Container created: 8c280bfd6b96
2025/11/19 11:48:29 ğŸ³ Starting container: 8c280bfd6b96
2025/11/19 11:48:29 âœ… Container started: 8c280bfd6b96
2025/11/19 11:48:29 â³ Waiting for container id 8c280bfd6b96 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc00024e3a8 Strategies:[0xc000152480]}
2025/11/19 11:48:30 ğŸ”” Container is ready: 8c280bfd6b96

2025/11/19 11:48:30 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.952ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:30 ğŸ³ Terminating container: 8c280bfd6b96
2025/11/19 11:48:30 ğŸš« Container terminated: 8c280bfd6b96
--- PASS: TestPnL_NoCloseWithinPeriod_ZeroPnLAndROI (1.30s)
=== RUN   TestPnL_PartialClose_Profit
2025/11/19 11:48:30 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:30 âœ… Container created: e56aa5196d38
2025/11/19 11:48:30 ğŸ³ Starting container: e56aa5196d38
2025/11/19 11:48:31 âœ… Container started: e56aa5196d38
2025/11/19 11:48:31 â³ Waiting for container id e56aa5196d38 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004c61b8 Strategies:[0xc0001d2360]}
2025/11/19 11:48:31 ğŸ”” Container is ready: e56aa5196d38

2025/11/19 11:48:32 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.935ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:32 ğŸ³ Terminating container: e56aa5196d38
2025/11/19 11:48:32 ğŸš« Container terminated: e56aa5196d38
--- PASS: TestPnL_PartialClose_Profit (1.29s)
=== RUN   TestPnL_MultipleCloses_FinalCloseAll_Loss
2025/11/19 11:48:32 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:32 âœ… Container created: ddcb6a16718a
2025/11/19 11:48:32 ğŸ³ Starting container: ddcb6a16718a
2025/11/19 11:48:32 âœ… Container started: ddcb6a16718a
2025/11/19 11:48:32 â³ Waiting for container id ddcb6a16718a image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004e6ab8 Strategies:[0xc000170a50]}
2025/11/19 11:48:33 ğŸ”” Container is ready: ddcb6a16718a

2025/11/19 11:48:33 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.961ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
    pnl_test.go:616: expected PnL 25, got 0
    pnl_test.go:619: expected ROI 12.5%, got 0%
2025/11/19 11:48:33 ğŸ³ Terminating container: ddcb6a16718a
2025/11/19 11:48:33 ğŸš« Container terminated: ddcb6a16718a
--- FAIL: TestPnL_MultipleCloses_FinalCloseAll_Loss (1.28s)
=== RUN   TestPnL_OverWithdraw_SingleDeposit
2025/11/19 11:48:33 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:33 âœ… Container created: c858bf255265
2025/11/19 11:48:33 ğŸ³ Starting container: c858bf255265
2025/11/19 11:48:33 âœ… Container started: c858bf255265
2025/11/19 11:48:33 â³ Waiting for container id c858bf255265 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004c6448 Strategies:[0xc00027f170]}
2025/11/19 11:48:34 ğŸ”” Container is ready: c858bf255265

2025/11/19 11:48:34 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.743ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
    pnl_test.go:673: expected PnL 200, got 0
    pnl_test.go:676: expected ROI 200%, got 0%
2025/11/19 11:48:34 ğŸ³ Terminating container: c858bf255265
2025/11/19 11:48:34 ğŸš« Container terminated: c858bf255265
--- FAIL: TestPnL_OverWithdraw_SingleDeposit (1.33s)
=== RUN   TestPnL_OverWithdraw_MultiDeposits
2025/11/19 11:48:34 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:34 âœ… Container created: cb9194673e4b
2025/11/19 11:48:34 ğŸ³ Starting container: cb9194673e4b
2025/11/19 11:48:35 âœ… Container started: cb9194673e4b
2025/11/19 11:48:35 â³ Waiting for container id cb9194673e4b image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005a66e0 Strategies:[0xc0006173e0]}
2025/11/19 11:48:35 ğŸ”” Container is ready: cb9194673e4b

2025/11/19 11:48:35 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.025ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
    pnl_test.go:738: expected PnL 150, got 0
    pnl_test.go:741: expected ROI 100%, got 0%
2025/11/19 11:48:35 ğŸ³ Terminating container: cb9194673e4b
2025/11/19 11:48:36 ğŸš« Container terminated: cb9194673e4b
--- FAIL: TestPnL_OverWithdraw_MultiDeposits (1.27s)
=== RUN   TestReportingHandlers_SpendingAndCashflow
2025/11/19 11:48:36 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:36 âœ… Container created: 3d0de7c89e39
2025/11/19 11:48:36 ğŸ³ Starting container: 3d0de7c89e39
2025/11/19 11:48:36 âœ… Container started: 3d0de7c89e39
2025/11/19 11:48:36 â³ Waiting for container id 3d0de7c89e39 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004c6bb8 Strategies:[0xc000617680]}
2025/11/19 11:48:37 ğŸ”” Container is ready: 3d0de7c89e39
2025/11/19 11:48:37 ğŸ³ Terminating container: 3d0de7c89e39
2025/11/19 11:48:37 ğŸš« Container terminated: 3d0de7c89e39
--- PASS: TestReportingHandlers_SpendingAndCashflow (1.25s)
=== RUN   TestReportingService_GetSpending_WithBreakdowns
2025/11/19 11:48:37 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:37 âœ… Container created: d776a88bf9ef
2025/11/19 11:48:37 ğŸ³ Starting container: d776a88bf9ef
2025/11/19 11:48:37 âœ… Container started: d776a88bf9ef
2025/11/19 11:48:37 â³ Waiting for container id d776a88bf9ef image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0003253b0 Strategies:[0xc0004edbf0]}
2025/11/19 11:48:38 ğŸ”” Container is ready: d776a88bf9ef
2025/11/19 11:48:38 ğŸ³ Terminating container: d776a88bf9ef
2025/11/19 11:48:38 ğŸš« Container terminated: d776a88bf9ef
--- PASS: TestReportingService_GetSpending_WithBreakdowns (1.28s)
=== RUN   TestTransactionService_UpdateTransaction
2025/11/19 11:48:38 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:38 âœ… Container created: d5328c60fdf4
2025/11/19 11:48:38 ğŸ³ Starting container: d5328c60fdf4
2025/11/19 11:48:38 âœ… Container started: d5328c60fdf4
2025/11/19 11:48:38 â³ Waiting for container id d5328c60fdf4 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005a65e8 Strategies:[0xc000591320]}
2025/11/19 11:48:39 ğŸ”” Container is ready: d5328c60fdf4
2025/11/19 11:48:39 ğŸ³ Terminating container: d5328c60fdf4
2025/11/19 11:48:39 ğŸš« Container terminated: d5328c60fdf4
--- PASS: TestTransactionService_UpdateTransaction (1.25s)
=== RUN   TestTransactionService_UpdateTransactionMultipleFields
2025/11/19 11:48:39 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:39 âœ… Container created: 4908ae877a7d
2025/11/19 11:48:39 ğŸ³ Starting container: 4908ae877a7d
2025/11/19 11:48:40 âœ… Container started: 4908ae877a7d
2025/11/19 11:48:40 â³ Waiting for container id 4908ae877a7d image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004fef28 Strategies:[0xc00049cff0]}
2025/11/19 11:48:40 ğŸ”” Container is ready: 4908ae877a7d
2025/11/19 11:48:40 ğŸ³ Terminating container: 4908ae877a7d
2025/11/19 11:48:41 ğŸš« Container terminated: 4908ae877a7d
--- PASS: TestTransactionService_UpdateTransactionMultipleFields (1.24s)
=== RUN   TestTransactionService_CreateTransaction_WithFees
2025/11/19 11:48:41 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:41 âœ… Container created: 1c0925969bbb
2025/11/19 11:48:41 ğŸ³ Starting container: 1c0925969bbb
2025/11/19 11:48:41 âœ… Container started: 1c0925969bbb
2025/11/19 11:48:41 â³ Waiting for container id 1c0925969bbb image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004e6c20 Strategies:[0xc000616540]}
2025/11/19 11:48:42 ğŸ”” Container is ready: 1c0925969bbb
2025/11/19 11:48:42 ğŸ³ Terminating container: 1c0925969bbb
2025/11/19 11:48:42 ğŸš« Container terminated: 1c0925969bbb
--- PASS: TestTransactionService_CreateTransaction_WithFees (1.16s)
=== RUN   TestTransactionService_UpdateTransactionNotFound
2025/11/19 11:48:42 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:42 âœ… Container created: a71c9c5d8fd5
2025/11/19 11:48:42 ğŸ³ Starting container: a71c9c5d8fd5
2025/11/19 11:48:42 âœ… Container started: a71c9c5d8fd5
2025/11/19 11:48:42 â³ Waiting for container id a71c9c5d8fd5 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000392cc0 Strategies:[0xc00061ad20]}
2025/11/19 11:48:43 ğŸ”” Container is ready: a71c9c5d8fd5

2025/11/19 11:48:43 [31;1m/Users/mac/personal/nami/backend/internal/repositories/transaction_repository.go:72 [35;1mrecord not found
[0m[33m[1.019ms] [34;1m[rows:0][0m SELECT * FROM "transactions" WHERE id = '3e5d0090-3e1b-4cf4-900d-cd48a058a03e' ORDER BY "transactions"."id" LIMIT 1
2025/11/19 11:48:43 ğŸ³ Terminating container: a71c9c5d8fd5
2025/11/19 11:48:43 ğŸš« Container terminated: a71c9c5d8fd5
--- PASS: TestTransactionService_UpdateTransactionNotFound (1.24s)
=== RUN   TestTransactionService_ExportTransactions
2025/11/19 11:48:43 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:43 âœ… Container created: 9d0ebddf2ef9
2025/11/19 11:48:43 ğŸ³ Starting container: 9d0ebddf2ef9
2025/11/19 11:48:43 âœ… Container started: 9d0ebddf2ef9
2025/11/19 11:48:43 â³ Waiting for container id 9d0ebddf2ef9 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004c7bd8 Strategies:[0xc00027f2f0]}
2025/11/19 11:48:44 ğŸ”” Container is ready: 9d0ebddf2ef9
2025/11/19 11:48:44 ğŸ³ Terminating container: 9d0ebddf2ef9
2025/11/19 11:48:44 ğŸš« Container terminated: 9d0ebddf2ef9
--- PASS: TestTransactionService_ExportTransactions (1.27s)
=== RUN   TestTransactionService_ImportTransactions_CreateAndUpsert
2025/11/19 11:48:44 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:44 âœ… Container created: 7b3e0eb2a5ae
2025/11/19 11:48:44 ğŸ³ Starting container: 7b3e0eb2a5ae
2025/11/19 11:48:44 âœ… Container started: 7b3e0eb2a5ae
2025/11/19 11:48:44 â³ Waiting for container id 7b3e0eb2a5ae image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc00049b058 Strategies:[0xc000591230]}
2025/11/19 11:48:45 ğŸ”” Container is ready: 7b3e0eb2a5ae
2025/11/19 11:48:45 ğŸ³ Terminating container: 7b3e0eb2a5ae
2025/11/19 11:48:45 ğŸš« Container terminated: 7b3e0eb2a5ae
--- PASS: TestTransactionService_ImportTransactions_CreateAndUpsert (1.22s)
=== RUN   TestTransactionValidation
=== RUN   TestTransactionValidation/valid_transaction
=== RUN   TestTransactionValidation/missing_date
=== RUN   TestTransactionValidation/missing_type
=== RUN   TestTransactionValidation/zero_quantity
=== RUN   TestTransactionValidation/negative_price
--- PASS: TestTransactionValidation (0.00s)
    --- PASS: TestTransactionValidation/valid_transaction (0.00s)
    --- PASS: TestTransactionValidation/missing_date (0.00s)
    --- PASS: TestTransactionValidation/missing_type (0.00s)
    --- PASS: TestTransactionValidation/zero_quantity (0.00s)
    --- PASS: TestTransactionValidation/negative_price (0.00s)
=== RUN   TestCalculateDerivedFields
=== RUN   TestCalculateDerivedFields/buy_transaction
=== RUN   TestCalculateDerivedFields/sell_transaction
=== RUN   TestCalculateDerivedFields/credit_card_expense
--- PASS: TestCalculateDerivedFields (0.00s)
    --- PASS: TestCalculateDerivedFields/buy_transaction (0.00s)
    --- PASS: TestCalculateDerivedFields/sell_transaction (0.00s)
    --- PASS: TestCalculateDerivedFields/credit_card_expense (0.00s)
=== RUN   TestUnstake_AmountOnly_UsesFetchedPriceAndPnL
2025/11/19 11:48:45 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:46 âœ… Container created: 5aa9df20cc9e
2025/11/19 11:48:46 ğŸ³ Starting container: 5aa9df20cc9e
2025/11/19 11:48:46 âœ… Container started: 5aa9df20cc9e
2025/11/19 11:48:46 â³ Waiting for container id 5aa9df20cc9e image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004e7368 Strategies:[0xc00049d5c0]}
2025/11/19 11:48:46 ğŸ”” Container is ready: 5aa9df20cc9e

2025/11/19 11:48:47 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.801ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:47 ğŸ³ Terminating container: 5aa9df20cc9e
2025/11/19 11:48:47 ğŸš« Container terminated: 5aa9df20cc9e
--- PASS: TestUnstake_AmountOnly_UsesFetchedPriceAndPnL (1.25s)
=== RUN   TestUnstake_CloseAll_ExitAmountUSD_PriceDerivedAndPnL
2025/11/19 11:48:47 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:47 âœ… Container created: f32ee9cc085e
2025/11/19 11:48:47 ğŸ³ Starting container: f32ee9cc085e
2025/11/19 11:48:47 âœ… Container started: f32ee9cc085e
2025/11/19 11:48:47 â³ Waiting for container id f32ee9cc085e image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004fe448 Strategies:[0xc0005e6000]}
2025/11/19 11:48:48 ğŸ”” Container is ready: f32ee9cc085e

2025/11/19 11:48:48 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.915ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Futures' AND is_open = true) AND horizon = 'short-term' ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:48 ğŸ³ Terminating container: f32ee9cc085e
2025/11/19 11:48:48 ğŸš« Container terminated: f32ee9cc085e
--- PASS: TestUnstake_CloseAll_ExitAmountUSD_PriceDerivedAndPnL (1.29s)
=== RUN   TestVault_DepositValidation
2025/11/19 11:48:48 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:48 âœ… Container created: 863f2c4db9dd
2025/11/19 11:48:48 ğŸ³ Starting container: 863f2c4db9dd
2025/11/19 11:48:48 âœ… Container started: 863f2c4db9dd
2025/11/19 11:48:48 â³ Waiting for container id 863f2c4db9dd image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000522b68 Strategies:[0xc000591140]}
2025/11/19 11:48:49 ğŸ”” Container is ready: 863f2c4db9dd

2025/11/19 11:48:49 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.935ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1

2025/11/19 11:48:49 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:35 [35;1mERROR: invalid input syntax for type uuid: "not-found-id" (SQLSTATE 22P02)
[0m[33m[0.916ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE id = 'not-found-id' ORDER BY "investments"."id" LIMIT 1
2025/11/19 11:48:49 ğŸ³ Terminating container: 863f2c4db9dd
2025/11/19 11:48:49 ğŸš« Container terminated: 863f2c4db9dd
--- PASS: TestVault_DepositValidation (1.30s)
=== RUN   TestVault_WithdrawValidation
2025/11/19 11:48:49 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:49 âœ… Container created: 87d3bca074ed
2025/11/19 11:48:49 ğŸ³ Starting container: 87d3bca074ed
2025/11/19 11:48:49 âœ… Container started: 87d3bca074ed
2025/11/19 11:48:49 â³ Waiting for container id 87d3bca074ed image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000803f28 Strategies:[0xc0005e7c20]}
2025/11/19 11:48:50 ğŸ”” Container is ready: 87d3bca074ed

2025/11/19 11:48:50 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.867ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'BTC' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1

2025/11/19 11:48:50 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:35 [35;1mERROR: invalid input syntax for type uuid: "not-found-id" (SQLSTATE 22P02)
[0m[33m[0.543ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE id = 'not-found-id' ORDER BY "investments"."id" LIMIT 1
2025/11/19 11:48:50 ğŸ³ Terminating container: 87d3bca074ed
2025/11/19 11:48:51 ğŸš« Container terminated: 87d3bca074ed
--- PASS: TestVault_WithdrawValidation (1.24s)
=== RUN   TestVault_RouteMisuseAndUnknownActions
2025/11/19 11:48:51 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:51 âœ… Container created: ffd20c5fb505
2025/11/19 11:48:51 ğŸ³ Starting container: ffd20c5fb505
2025/11/19 11:48:51 âœ… Container started: ffd20c5fb505
2025/11/19 11:48:51 â³ Waiting for container id ffd20c5fb505 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0008032e8 Strategies:[0xc0005e6750]}
2025/11/19 11:48:52 ğŸ”” Container is ready: ffd20c5fb505
    vault_input_validation_test.go:173: expected 405 for POST /api/vaults, got 400
2025/11/19 11:48:52 ğŸ³ Terminating container: ffd20c5fb505
2025/11/19 11:48:52 ğŸš« Container terminated: ffd20c5fb505
--- FAIL: TestVault_RouteMisuseAndUnknownActions (1.28s)
=== RUN   TestVault_EndZeroROI_APRAbsent
2025/11/19 11:48:52 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:52 âœ… Container created: 998ea7f27b3c
2025/11/19 11:48:52 ğŸ³ Starting container: 998ea7f27b3c
2025/11/19 11:48:52 âœ… Container started: 998ea7f27b3c
2025/11/19 11:48:52 â³ Waiting for container id 998ea7f27b3c image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004e7050 Strategies:[0xc0003949c0]}
2025/11/19 11:48:53 ğŸ”” Container is ready: 998ea7f27b3c

2025/11/19 11:48:53 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.970ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:53 ğŸ³ Terminating container: 998ea7f27b3c
2025/11/19 11:48:53 ğŸš« Container terminated: 998ea7f27b3c
--- PASS: TestVault_EndZeroROI_APRAbsent (1.24s)
=== RUN   TestVault_ListFilter_IsOpen
2025/11/19 11:48:53 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:53 âœ… Container created: 16b79b7c7f73
2025/11/19 11:48:53 ğŸ³ Starting container: 16b79b7c7f73
2025/11/19 11:48:53 âœ… Container started: 16b79b7c7f73
2025/11/19 11:48:53 â³ Waiting for container id 16b79b7c7f73 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000522da8 Strategies:[0xc000575650]}
2025/11/19 11:48:54 ğŸ”” Container is ready: 16b79b7c7f73

2025/11/19 11:48:54 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.131ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1

2025/11/19 11:48:54 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.652ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'BTC' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
    vault_input_validation_test.go:337: expected at least one closed vault
2025/11/19 11:48:54 ğŸ³ Terminating container: 16b79b7c7f73
2025/11/19 11:48:54 ğŸš« Container terminated: 16b79b7c7f73
--- FAIL: TestVault_ListFilter_IsOpen (1.37s)
=== RUN   TestVault_OverWithdraw_CorrectPnL
2025/11/19 11:48:54 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:55 âœ… Container created: a4e3e096a115
2025/11/19 11:48:55 ğŸ³ Starting container: a4e3e096a115
2025/11/19 11:48:55 âœ… Container started: a4e3e096a115
2025/11/19 11:48:55 â³ Waiting for container id a4e3e096a115 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004c6eb8 Strategies:[0xc000574990]}
2025/11/19 11:48:55 ğŸ”” Container is ready: a4e3e096a115

2025/11/19 11:48:56 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.401ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:56 ğŸ³ Terminating container: a4e3e096a115
2025/11/19 11:48:56 ğŸš« Container terminated: a4e3e096a115
--- PASS: TestVault_OverWithdraw_CorrectPnL (1.28s)
=== RUN   TestVaultPnLAndROI_ComputesCorrectly_OnFullExit
2025/11/19 11:48:56 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:56 âœ… Container created: 5725ad24b122
2025/11/19 11:48:56 ğŸ³ Starting container: 5725ad24b122
2025/11/19 11:48:56 âœ… Container started: 5725ad24b122
2025/11/19 11:48:56 â³ Waiting for container id 5725ad24b122 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000803568 Strategies:[0xc000695f20]}
2025/11/19 11:48:57 ğŸ”” Container is ready: 5725ad24b122

2025/11/19 11:48:57 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.266ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:57 ğŸ³ Terminating container: 5725ad24b122
2025/11/19 11:48:57 ğŸš« Container terminated: 5725ad24b122
--- PASS: TestVaultPnLAndROI_ComputesCorrectly_OnFullExit (1.27s)
=== RUN   TestVaultPnL_RemainsZero_OnPartialWhileOpen
2025/11/19 11:48:57 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:57 âœ… Container created: 0c6c076bd70d
2025/11/19 11:48:57 ğŸ³ Starting container: 0c6c076bd70d
2025/11/19 11:48:57 âœ… Container started: 0c6c076bd70d
2025/11/19 11:48:57 â³ Waiting for container id 0c6c076bd70d image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000325560 Strategies:[0xc0004ec450]}
2025/11/19 11:48:58 ğŸ”” Container is ready: 0c6c076bd70d

2025/11/19 11:48:58 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.109ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'BTC' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:58 ğŸ³ Terminating container: 0c6c076bd70d
2025/11/19 11:48:58 ğŸš« Container terminated: 0c6c076bd70d
--- PASS: TestVaultPnL_RemainsZero_OnPartialWhileOpen (1.35s)
=== RUN   TestVault_End_ClosesInvestment
2025/11/19 11:48:58 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:48:58 âœ… Container created: b11e21d965ad
2025/11/19 11:48:58 ğŸ³ Starting container: b11e21d965ad
2025/11/19 11:48:59 âœ… Container started: b11e21d965ad
2025/11/19 11:48:59 â³ Waiting for container id b11e21d965ad image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc000393b70 Strategies:[0xc0004a9320]}
2025/11/19 11:48:59 ğŸ”” Container is ready: b11e21d965ad

2025/11/19 11:48:59 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.014ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:48:59 ğŸ³ Terminating container: b11e21d965ad
2025/11/19 11:49:00 ğŸš« Container terminated: b11e21d965ad
--- PASS: TestVault_End_ClosesInvestment (1.29s)
=== RUN   TestVault_FullWithdraw_DoesNotAutoClose
2025/11/19 11:49:00 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:49:00 âœ… Container created: 6114b6f35f13
2025/11/19 11:49:00 ğŸ³ Starting container: 6114b6f35f13
2025/11/19 11:49:00 âœ… Container started: 6114b6f35f13
2025/11/19 11:49:00 â³ Waiting for container id 6114b6f35f13 image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004c74b8 Strategies:[0xc0001662a0]}
2025/11/19 11:49:01 ğŸ”” Container is ready: 6114b6f35f13

2025/11/19 11:49:01 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[0.919ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'USDT' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1
2025/11/19 11:49:01 ğŸ³ Terminating container: 6114b6f35f13
2025/11/19 11:49:01 ğŸš« Container terminated: 6114b6f35f13
--- PASS: TestVault_FullWithdraw_DoesNotAutoClose (1.26s)
=== RUN   TestVault_Delete_RemovesInvestmentAndTransactions
2025/11/19 11:49:01 ğŸ³ Creating container for image postgres:15-alpine
2025/11/19 11:49:01 âœ… Container created: 22e0daeb2b1d
2025/11/19 11:49:01 ğŸ³ Starting container: 22e0daeb2b1d
2025/11/19 11:49:01 âœ… Container started: 22e0daeb2b1d
2025/11/19 11:49:01 â³ Waiting for container id 22e0daeb2b1d image: postgres:15-alpine. Waiting for: &{timeout:<nil> deadline:0xc0006c1760 Strategies:[0xc0005ec480]}
2025/11/19 11:49:02 ğŸ”” Container is ready: 22e0daeb2b1d

2025/11/19 11:49:02 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:255 [35;1mrecord not found
[0m[33m[1.228ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE (asset = 'BTC' AND account = 'Kyberswap' AND is_open = true) AND horizon IS NULL ORDER BY deposit_date ASC,"investments"."id" LIMIT 1

2025/11/19 11:49:02 [31;1m/Users/mac/personal/nami/backend/internal/repositories/investment_repository.go:35 [35;1mrecord not found
[0m[33m[0.634ms] [34;1m[rows:0][0m SELECT * FROM "investments" WHERE id = '04b0c6bf-b4be-4f3c-bf73-fbe1286d83f1' ORDER BY "investments"."id" LIMIT 1
2025/11/19 11:49:02 ğŸ³ Terminating container: 22e0daeb2b1d
2025/11/19 11:49:02 ğŸš« Container terminated: 22e0daeb2b1d
--- PASS: TestVault_Delete_RemovesInvestmentAndTransactions (1.38s)
FAIL
FAIL	github.com/tropicaldog17/nami/tests/integration	53.562s
FAIL
